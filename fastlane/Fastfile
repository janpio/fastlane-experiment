lane :remote_action do
    # TODO Check if required ENV vars are set, exit if not
    action = ENV['ACTION']
    if action == 'scan'
        remote_scan
    else
        puts "Don't know how to handle this action."
    end
end

lane :remote_scan do
    upload_id = ENV['UPLOAD_ID']

    download_file(
        url: "http://remote-fastlane.betamo.de/uploads/#{upload_id}", 
        destination_path: './tmp/archive.zip'
    )
    unzip(
        file: "./tmp/archive.zip", 
        destination_path: "./tmp/app/"
    )
    test
end

lane :test do
    #puts Dir.pwd
    #Dir.chdir("../tmp/app") do
        #puts Dir.pwd
        #puts Dir["./*.xcodeproj"]
        run_tests(
            project: "tmp/app/iosapp.xcodeproj", # TODO Find correct path automatically
            device: "iPhone 5s"
        )
    #end
end